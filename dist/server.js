(()=>{"use strict";var e={6752:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(2127)),o=n(r(5619)),s=n(r(9910)),u=n(r(8150)),a=n(r(479)),l=n(r(6725)),c=r(9905),f=r(9204),d=n(r(6677)),h=n(r(2615)),p=function(){function e(e){this.app=i.default(),this.port=process.env.PORT||5e3,this.production=!0,this.connectToDatabase(),this.initializeMiddleware(),this.initializeRoutes(e),this.initializeErrorMiddleware(),this.initializeSwagger()}return e.prototype.listen=function(){var e=this;this.app.listen(this.port,(function(){c.Logger.info("Server is listening on port "+e.port)}))},e.prototype.initializeRoutes=function(e){var t=this;e.forEach((function(e){t.app.use("/",e.router)}))},e.prototype.initializeMiddleware=function(){this.production?(this.app.use(s.default()),this.app.use(l.default()),this.app.use(u.default("combined")),this.app.use(a.default({origin:"your.domain.com",credentials:!0}))):(this.app.use(u.default("dev")),this.app.use(a.default({origin:!0,credentials:!0}))),this.app.use(i.default.json()),this.app.use(i.default.urlencoded({extended:!0}))},e.prototype.initializeErrorMiddleware=function(){this.app.use(f.errorMiddleware)},e.prototype.connectToDatabase=function(){var e=process.env.MONGODB_URI;e?(o.default.connect(e,{useNewUrlParser:!0,useUnifiedTopology:!0,useFindAndModify:!1,useCreateIndex:!0}).catch((function(e){c.Logger.error(e)})),c.Logger.info("Database connected...")):c.Logger.error("Connection string is invalid")},e.prototype.initializeSwagger=function(){var e=h.default.load("./src/swagger.yaml");this.app.use("/swagger",d.default.serve,d.default.setup(e))},e}();t.default=p},4427:function(e,t){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,r){var n=e.call(this,r)||this;return n.status=t,n.message=r,n}return n(t,e),t}(Error);t.default=i},5729:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpException=void 0;var i=n(r(4427));t.HttpException=i.default},5191:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(9722));t.default=function(e,t,r){var n=e.header("x-auth-token");if(!n)return t.status(401).json({message:"No token, authorization denied."});try{var o=i.default.verify(n,process.env.JWT_TOKEN_SECRET);e.user||(e.user={id:""}),e.user.id=o.id,r()}catch(e){r(e)}}},8738:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(9905);t.default=function(e,t,r,i){var o=e.status||500,s=e.message||"Some thing when wrong";n.Logger.error("[ERROR]- Status: "+o+" - Msg: "+s),r.status(o).json({message:s})}},9204:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validationMiddleware=t.authMiddleware=t.errorMiddleware=void 0;var i=n(r(5191));t.authMiddleware=i.default;var o=n(r(8738));t.errorMiddleware=o.default;var s=n(r(1580));t.validationMiddleware=s.default},1580:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(1576),i=r(516),o=r(9905),s=r(5729);t.default=function(e,t){return void 0===t&&(t=!1),function(r,u,a){i.validate(n.plainToClass(e,r.body),{skipMissingProperties:t}).then((function(e){if(e.length>0){o.Logger.error(e);var t=e.map((function(e){return Object.values(e.constraints)})).join(",");a(new s.HttpException(400,t))}else a()}))}}},7093:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyObject=void 0,t.isEmptyObject=function(e){return!Object.keys(e).length}},9905:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyObject=t.validateEnv=t.Logger=void 0;var i=r(7093);Object.defineProperty(t,"isEmptyObject",{enumerable:!0,get:function(){return i.isEmptyObject}});var o=n(r(1495));t.Logger=o.default;var s=n(r(1557));t.validateEnv=s.default},1495:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(944)),o=i.default.createLogger({transports:[new i.default.transports.File({filename:"./logs/error.log",level:"error"}),new i.default.transports.File({filename:"./logs/combined.log"})],format:i.default.format.combine(i.default.format.colorize({all:!0}),i.default.format.simple())});o.add(new i.default.transports.Console({format:i.default.format.simple()})),t.default=o},1557:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(9509);t.default=function(){n.cleanEnv(process.env,{NODE_ENV:n.str(),MONGODB_URI:n.str()})}},4679:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{a(n.next(e))}catch(e){o(e)}}function u(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(r(7701));t.default=function(){var e=this;this.authService=new s.default,this.login=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=t.body,[4,this.authService.login(e)];case 1:return n=i.sent(),r.status(200).json(n),[3,3];case 2:return s=i.sent(),o(s),[3,3];case 3:return[2]}}))}))},this.getCurrentLoginUser=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.authService.getCurrentLoginUser(t.user.id)];case 1:return e=i.sent(),r.status(200).json(e),[3,3];case 2:return n=i.sent(),o(n),[3,3];case 3:return[2]}}))}))}}},2679:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(9204),o=r(2127),s=n(r(4679)),u=function(){function e(){this.path="/api/v1/auth",this.router=o.Router(),this.authController=new s.default,this.initializeRoutes()}return e.prototype.initializeRoutes=function(){this.router.post(this.path,this.authController.login),this.router.get(this.path,i.authMiddleware,this.authController.getCurrentLoginUser)},e}();t.default=u},7701:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{a(n.next(e))}catch(e){o(e)}}function u(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(5729),u=r(9905),a=r(2333),l=o(r(2773)),c=o(r(9722)),f=function(){function e(){this.userSchema=a.UserSchema}return e.prototype.login=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:if(u.isEmptyObject(e))throw new s.HttpException(400,"Model is empty");return[4,this.userSchema.findOne({email:e.email})];case 1:if(!(t=r.sent()))throw new s.HttpException(409,"Your email "+e.email+" is not exist.");return[4,l.default.compare(e.password,t.password)];case 2:if(!r.sent())throw new s.HttpException(400,"Credential is not valid");return[2,this.createToken(t)]}}))}))},e.prototype.getCurrentLoginUser=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(r){switch(r.label){case 0:return[4,this.userSchema.findById(e)];case 1:if(!(t=r.sent()))throw new s.HttpException(404,"User is not exists");return[2,t]}}))}))},e.prototype.createToken=function(e){var t={id:e._id},r=process.env.JWT_TOKEN_SECRET;return{token:c.default.sign(t,r,{expiresIn:3600})}},e}();t.default=f},6553:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthRoute=void 0;var i=n(r(2679));t.AuthRoute=i.default},6145:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){this.index=function(e,t,r){try{t.status(200).json("Api is running...")}catch(e){r(e)}}}},304:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(2127),o=n(r(6145)),s=function(){function e(){this.path="/",this.router=i.Router(),this.indexController=new o.default,this.initializeRoutes()}return e.prototype.initializeRoutes=function(){this.router.get(this.path,this.indexController.index)},e}();t.default=s},1570:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.IndexRoute=t.IndexController=void 0;var i=n(r(6145));t.IndexController=i.default;var o=n(r(304));t.IndexRoute=o.default},5303:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){}},2484:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostRoute=void 0;var i=n(r(3));t.PostRoute=i.default},1531:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{a(n.next(e))}catch(e){o(e)}}function u(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(r(6135));t.default=function(){var e=this;this.postService=new s.default,this.createPost=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s,u;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=t.body,n=t.user.id,[4,this.postService.createPost(n,e)];case 1:return s=i.sent(),[2,r.status(201).json(s)];case 2:return u=i.sent(),o(u),[3,3];case 3:return[2]}}))}))},this.updatePost=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s,u;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=t.body,n=t.params.id,[4,this.postService.updatePost(n,e)];case 1:return s=i.sent(),[2,r.status(200).json(s)];case 2:return u=i.sent(),o(u),[3,3];case 3:return[2]}}))}))},this.getPostById=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=t.params.id,[4,this.postService.getPostById(e)];case 1:return n=i.sent(),r.status(200).json(n),[3,3];case 2:return s=i.sent(),o(s),[3,3];case 3:return[2]}}))}))},this.getAllPosts=function(t,r,o){return n(e,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.postService.getAllPosts()];case 1:return e=n.sent(),[2,r.status(200).json(e)];case 2:return t=n.sent(),o(t),[3,3];case 3:return[2]}}))}))},this.getAllPaging=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s,u;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=Number(t.params.page),n=t.query.keyword||"",[4,this.postService.getAllPaging(n.toString(),e)];case 1:return s=i.sent(),[2,r.status(200).json(s)];case 2:return u=i.sent(),o(u),[3,3];case 3:return[2]}}))}))},this.deletePost=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=t.params.id,[4,this.postService.deletePost(t.user.id,e)];case 1:return n=i.sent(),[2,r.status(200).json(n)];case 2:return s=i.sent(),o(s),[3,3];case 3:return[2]}}))}))},this.likePost=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=t.params.id,[4,this.postService.likePost(t.user.id,e)];case 1:return n=i.sent(),r.status(200).json(n),[3,3];case 2:return s=i.sent(),o(s),[3,3];case 3:return[2]}}))}))},this.unlikePost=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=t.params.id,[4,this.postService.unlikePost(t.user.id,e)];case 1:return n=i.sent(),r.status(200).json(n),[3,3];case 2:return s=i.sent(),o(s),[3,3];case 3:return[2]}}))}))}}},2279:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(5619)),o=new i.default.Schema({user:{type:i.default.Schema.Types.ObjectId,ref:"user"},text:{type:String,required:!0},name:{type:String},avatar:{type:String},likes:[{user:{type:i.default.Schema.Types.ObjectId}}],comments:[{user:{type:i.default.Schema.Types.ObjectId},text:{type:String,required:!0},name:{type:String},avatar:{type:String},date:{type:Date,default:Date.now}}],date:{type:Date,default:Date.now}});t.default=i.default.model("post",o)},3:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(5191)),o=n(r(1580)),s=r(2127),u=n(r(5303)),a=n(r(1531)),l=function(){function e(){this.path="/api/v1/posts",this.router=s.Router(),this.postsController=new a.default,this.initializeRoutes()}return e.prototype.initializeRoutes=function(){this.router.post(this.path,i.default,o.default(u.default,!0),this.postsController.createPost),this.router.put(this.path+"/:id",i.default,o.default(u.default,!0),this.postsController.updatePost),this.router.get(this.path,this.postsController.getAllPosts),this.router.get(this.path+"/:id",this.postsController.getPostById),this.router.get(this.path+"/paging/:page",this.postsController.getAllPaging),this.router.delete(this.path+"/:id",i.default,this.postsController.deletePost),this.router.put(this.path+"/like/:id",i.default,this.postsController.likePost),this.router.put(this.path+"/unlike/:id",i.default,this.postsController.unlikePost)},e}();t.default=l},6135:function(e,t,r){var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{a(n.next(e))}catch(e){o(e)}}function u(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(5729),a=r(2333),l=s(r(2279)),c=function(){function e(){}return e.prototype.createPost=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,a.UserSchema.findById(e).select("-password").exec()];case 1:if(!(r=n.sent()))throw new u.HttpException(400,"User id is not exist");return[4,new l.default({text:t.text,name:r.first_name+""+r.last_name,avatar:r.avatar,user:e}).save()];case 2:return[2,n.sent()]}}))}))},e.prototype.updatePost=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:return[4,l.default.findByIdAndUpdate(e,n({},t),{new:!0}).exec()];case 1:if(!(r=i.sent()))throw new u.HttpException(400,"Post is not found");return[2,r]}}))}))},e.prototype.getAllPosts=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,l.default.find().exec()];case 1:return[2,e.sent()]}}))}))},e.prototype.getPostById=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return[4,l.default.findById(e).exec()];case 1:if(!(t=r.sent()))throw new u.HttpException(404,"Post is not found");return[2,t]}}))}))},e.prototype.getAllPaging=function(e,t){return i(this,void 0,void 0,(function(){var r,n,i;return o(this,(function(o){switch(o.label){case 0:return r=Number(process.env.PAGE_SIZE||10),n={},e&&(n={$or:[{text:e}]}),[4,l.default.find(n).skip((t-1)*r).limit(r).exec()];case 1:return i=o.sent(),[4,l.default.find(n).countDocuments().exec()];case 2:return[2,{total:o.sent(),page:t,pageSize:r,items:i}]}}))}))},e.prototype.deletePost=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,l.default.findByIdAndDelete(t).exec()];case 1:if(!(r=n.sent()))throw new u.HttpException(400,"Post not found");if(r.user.toString()!==e)throw new u.HttpException(400,"User is not authorized");return[4,r.remove()];case 2:return n.sent(),[2,r]}}))}))},e.prototype.likePost=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,l.default.findById(t).exec()];case 1:if(!(r=n.sent()))throw new u.HttpException(400,"Post not found");if(r.likes.some((function(t){return t.user.toString()===e})))throw new u.HttpException(400,"Post already liked");return r.likes.unshift({user:e}),[4,r.save()];case 2:return n.sent(),[2,r.likes]}}))}))},e.prototype.unlikePost=function(e,t){return i(this,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,l.default.findById(t).exec()];case 1:if(!(r=n.sent()))throw new u.HttpException(400,"Post not found");if(!r.likes.some((function(t){return t.user.toString()===e})))throw new u.HttpException(400,"Post has not yet been liked");return r.likes=r.likes.filter((function(t){return t.user.toString()!==e})),[4,r.save()];case 2:return n.sent(),[2,r.likes]}}))}))},e}();t.default=c},774:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){}},6697:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){}},3094:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t,r,n,i,o,s,u,a,l,c){this.company=e,this.location=t,this.website=r,this.bio=n,this.skills=i,this.status=o,this.youtube=s,this.twitter=u,this.instagram=a,this.linkedin=l,this.facebook=c}},418:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileSchema=t.ProfileRoute=void 0;var i=n(r(4731));t.ProfileRoute=i.default;var o=n(r(4202));t.ProfileSchema=o.default},2641:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{a(n.next(e))}catch(e){o(e)}}function u(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(r(7074));t.default=function(){var e=this;this.profileService=new s.default,this.getCurrentProfile=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=t.user.id,[4,this.profileService.getCurrentProfile(e)];case 1:return n=i.sent(),r.status(200).json(n),[3,3];case 2:return s=i.sent(),o(s),[3,3];case 3:return[2]}}))}))},this.getByUserId=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:e=t.params.id,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.profileService.getCurrentProfile(e)];case 2:return n=i.sent(),r.status(200).json({data:n,message:"updated"}),[3,4];case 3:return s=i.sent(),o(s),[3,4];case 4:return[2]}}))}))},this.getAllProfiles=function(t,r,o){return n(e,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.profileService.getAllProfiles()];case 1:return e=n.sent(),r.status(200).json(e),[3,3];case 2:return t=n.sent(),o(t),[3,3];case 3:return[2]}}))}))},this.createProfile=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s,u;return i(this,(function(i){switch(i.label){case 0:e=t.body,n=t.user.id,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.profileService.createProfile(n,e)];case 2:return s=i.sent(),r.status(201).json({data:s}),[3,4];case 3:return u=i.sent(),o(u),[3,4];case 4:return[2]}}))}))},this.deleteProfile=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n;return i(this,(function(i){switch(i.label){case 0:e=t.params.id,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.profileService.deleteProfile(e)];case 2:return i.sent(),r.status(200),[3,4];case 3:return n=i.sent(),o(n),[3,4];case 4:return[2]}}))}))},this.createExperience=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s,u;return i(this,(function(i){switch(i.label){case 0:e=t.user.id,n=t.body,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.profileService.addExperience(e,n)];case 2:return s=i.sent(),r.status(201).json(s),[3,4];case 3:return u=i.sent(),o(u),[3,4];case 4:return[2]}}))}))},this.deleteExperience=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:e=t.params.exp_id,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.profileService.deleteExperience(t.user.id,e)];case 2:return n=i.sent(),r.status(200).json(n),[3,4];case 3:return s=i.sent(),o(s),[3,4];case 4:return[2]}}))}))},this.createEducation=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s,u;return i(this,(function(i){switch(i.label){case 0:e=t.body,n=t.user.id,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.profileService.addEducation(n,e)];case 2:return s=i.sent(),r.status(201).json(s),[3,4];case 3:return u=i.sent(),o(u),[3,4];case 4:return[2]}}))}))},this.deleteEducation=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:e=t.params.edu_id,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.profileService.deleteEducation(t.user.id,e)];case 2:return n=i.sent(),r.status(200).json(n),[3,4];case 3:return s=i.sent(),o(s),[3,4];case 4:return[2]}}))}))}}},4202:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(5619)),o=new i.default.Schema({user:{type:i.default.Schema.Types.ObjectId,ref:"user"},company:{type:String},website:{type:String},location:{type:String},status:{type:String,required:!0},skills:{type:[String],required:!0},bio:{type:String},experience:[{title:{type:String,required:!0},company:{type:String,required:!0},location:{type:String},from:{type:Date,required:!0},to:{type:Date},current:{type:Boolean,default:!1},description:{type:String}}],education:[{school:{type:String,required:!0},degree:{type:String,required:!0},fieldofstudy:{type:String,required:!0},from:{type:Date,required:!0},to:{type:Date},current:{type:Boolean,default:!1},description:{type:String}}],social:{youtube:{type:String},twitter:{type:String},facebook:{type:String},linkedin:{type:String},instagram:{type:String}},date:{type:Date,default:Date.now}});t.default=i.default.model("profile",o)},4731:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(9204),o=r(2127),s=n(r(774)),u=n(r(6697)),a=n(r(3094)),l=n(r(2641)),c=function(){function e(){this.path="/api/v1/profile",this.router=o.Router(),this.profileController=new l.default,this.initializeRoutes()}return e.prototype.initializeRoutes=function(){this.router.get(""+this.path,this.profileController.getAllProfiles),this.router.get(this.path+"/user/:id",this.profileController.getByUserId),this.router.get(this.path+"/me",i.authMiddleware,this.profileController.getCurrentProfile),this.router.post(""+this.path,i.authMiddleware,i.validationMiddleware(a.default),this.profileController.createProfile),this.router.delete(this.path+"/:id",i.authMiddleware,this.profileController.deleteProfile),this.router.put(this.path+"/experience",i.authMiddleware,i.validationMiddleware(u.default),this.profileController.createExperience),this.router.delete(this.path+"/experience/:exp_id",i.authMiddleware,this.profileController.deleteExperience),this.router.put(this.path+"/education",i.authMiddleware,i.validationMiddleware(s.default),this.profileController.createEducation),this.router.delete(this.path+"/education/:edu_id",i.authMiddleware,this.profileController.deleteEducation)},e}();t.default=c},7074:function(e,t,r){var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{a(n.next(e))}catch(e){o(e)}}function u(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(5729),a=r(2333),l=s(r(4202)),c=s(r(9876)),f=function(){function e(){var e=this;this.addExperience=function(t,r){return i(e,void 0,void 0,(function(){var e,i;return o(this,(function(o){switch(o.label){case 0:return e=n({},r),[4,l.default.findOne({user:t}).exec()];case 1:if(!(i=o.sent()))throw new u.HttpException(400,"There is not profile for this user");return i.experience.unshift(e),[4,i.save()];case 2:return o.sent(),[2,i]}}))}))},this.deleteExperience=function(t,r){return i(e,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,l.default.findOne({user:t}).exec()];case 1:if(!(e=n.sent()))throw new u.HttpException(400,"There is not profile for this user");return e.experience=e.experience.filter((function(e){return e._id.toString()!==r})),[4,e.save()];case 2:return n.sent(),[2,e]}}))}))},this.addEducation=function(t,r){return i(e,void 0,void 0,(function(){var e,i;return o(this,(function(o){switch(o.label){case 0:return e=n({},r),[4,l.default.findOne({user:t}).exec()];case 1:if(!(i=o.sent()))throw new u.HttpException(400,"There is not profile for this user");return i.education.unshift(e),[4,i.save()];case 2:return o.sent(),[2,i]}}))}))},this.deleteEducation=function(t,r){return i(e,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return[4,l.default.findOne({user:t}).exec()];case 1:if(!(e=n.sent()))throw new u.HttpException(400,"There is not profile for this user");return e.education=e.education.filter((function(e){return e._id.toString()!==r})),[4,e.save()];case 2:return n.sent(),[2,e]}}))}))}}return e.prototype.getCurrentProfile=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return[4,l.default.findOne({user:e}).populate("user",["name","avatar"]).exec()];case 1:if(!(t=r.sent()))throw new u.HttpException(400,"There is no profile for this user");return[2,t]}}))}))},e.prototype.createProfile=function(e,t){return i(this,void 0,void 0,(function(){var r,n,i,s,u,a,f,d,h,p,v,y,w,b,_,g,m,x;return o(this,(function(o){switch(o.label){case 0:for(r=t.company,n=t.location,i=t.website,s=t.bio,u=t.skills,a=t.status,f=t.youtube,d=t.twitter,h=t.instagram,p=t.linkedin,v=t.facebook,y={user:e,company:r,location:n,website:i&&""!=i?c.default(i.toString(),{forceHttps:!0}):"",bio:s,skills:Array.isArray(u)?u:u.split(",").map((function(e){return" "+e.trim()})),status:a},w={youtube:f,twitter:d,instagram:h,linkedin:p,facebook:v},b=0,_=Object.entries(w);b<_.length;b++)g=_[b],m=g[0],(x=g[1])&&x.length>0&&(w[m]=c.default(x,{forceHttps:!0}));return y.social=w,[4,l.default.findOneAndUpdate({user:e},{$set:y},{new:!0,upsert:!0,setDefaultsOnInsert:!0}).exec()];case 1:return[2,o.sent()]}}))}))},e.prototype.deleteProfile=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,l.default.findOneAndRemove({user:e}).exec()];case 1:return t.sent(),[4,a.UserSchema.findOneAndRemove({_id:e}).exec()];case 2:return t.sent(),[2]}}))}))},e.prototype.getAllProfiles=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,l.default.find().populate("user",["name","avatar"]).exec()];case 1:return[2,e.sent()]}}))}))},e}();t.default=f},4237:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});var i=r(516),o=function(){function e(e,t,r,n){this.first_name=e,this.last_name=t,this.email=r,this.password=n}return n([i.IsNotEmpty()],e.prototype,"first_name",void 0),n([i.IsNotEmpty()],e.prototype,"last_name",void 0),n([i.IsNotEmpty(),i.IsEmail()],e.prototype,"email",void 0),n([i.IsNotEmpty(),i.MinLength(6,{message:"Password must be at least 6 characters"})],e.prototype,"password",void 0),e}();t.default=o},2333:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserSchema=t.UserRoute=t.UserController=void 0;var i=n(r(5887));t.UserController=i.default;var o=n(r(7939));t.UserRoute=o.default;var s=n(r(8499));t.UserSchema=s.default},5887:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{a(n.next(e))}catch(e){o(e)}}function u(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(r(6149));t.default=function(){var e=this;this.userService=new s.default,this.register=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=t.body,[4,this.userService.createUser(e)];case 1:return n=i.sent(),r.status(201).json(n),[3,3];case 2:return s=i.sent(),o(s),[3,3];case 3:return[2]}}))}))},this.updateUser=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=t.body,[4,this.userService.updateUser(t.params.id,e)];case 1:return n=i.sent(),r.status(200).json(n),[3,3];case 2:return s=i.sent(),o(s),[3,3];case 3:return[2]}}))}))},this.getUserById=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.userService.getUserById(t.params.id)];case 1:return e=i.sent(),r.status(200).json(e),[3,3];case 2:return n=i.sent(),o(n),[3,3];case 3:return[2]}}))}))},this.getAll=function(t,r,o){return n(e,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.userService.getAll()];case 1:return e=n.sent(),r.status(200).json(e),[3,3];case 2:return t=n.sent(),o(t),[3,3];case 3:return[2]}}))}))},this.getAllPaging=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n,s,u;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),e=Number(t.params.page),n=t.query.keyword||"",[4,this.userService.getAllPaging(n.toString(),e)];case 1:return s=i.sent(),r.status(200).json(s),[3,3];case 2:return u=i.sent(),o(u),[3,3];case 3:return[2]}}))}))},this.deleteUser=function(t,r,o){return n(e,void 0,void 0,(function(){var e,n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.userService.deleteUser(t.user.id)];case 1:return e=i.sent(),r.status(200).json(e),[3,3];case 2:return n=i.sent(),o(n),[3,3];case 3:return[2]}}))}))}}},8499:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(5619)),o=new i.default.Schema({first_name:{type:String,required:!0},last_name:{type:String,required:!0},email:{type:String,unique:!0,index:!0,required:!0},password:{type:String,required:!0},avatar:{type:String},date:{type:Date,default:Date.now}});t.default=i.default.model("user",o)},7939:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=r(9204),o=n(r(1580)),s=r(2127),u=n(r(4237)),a=n(r(5887)),l=function(){function e(){this.path="/api/v1/users",this.router=s.Router(),this.usersController=new a.default,this.initializeRoutes()}return e.prototype.initializeRoutes=function(){this.router.post(this.path,o.default(u.default,!0),this.usersController.register),this.router.put(this.path+"/:id",o.default(u.default,!0),this.usersController.updateUser),this.router.get(this.path+"/:id",this.usersController.getUserById),this.router.get(this.path,this.usersController.getAll),this.router.get(this.path+"/paging/:page",this.usersController.getAllPaging),this.router.delete(this.path+"/:id",i.authMiddleware,this.usersController.deleteUser)},e}();t.default=l},6149:function(e,t,r){var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{a(n.next(e))}catch(e){o(e)}}function u(e){try{a(n.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,u)}a((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=r(5729),a=s(r(8499)),l=r(7093),c=s(r(7967)),f=s(r(2773)),d=s(r(9722)),h=function(){function e(){this.userSchema=a.default}return e.prototype.createUser=function(e){return i(this,void 0,void 0,(function(){var t,r,i,s;return o(this,(function(o){switch(o.label){case 0:if(l.isEmptyObject(e))throw new u.HttpException(400,"Model is empty");return[4,this.userSchema.findOne({email:e.email})];case 1:if(o.sent())throw new u.HttpException(409,"Your email "+e.email+" already exist.");return t=c.default.url(e.email,{size:"200",rating:"g",default:"mm"}),[4,f.default.genSalt(10)];case 2:return r=o.sent(),[4,f.default.hash(e.password,r)];case 3:return i=o.sent(),[4,this.userSchema.create(n(n({},e),{password:i,avatar:t,date:Date.now()}))];case 4:return s=o.sent(),[2,this.createToken(s)]}}))}))},e.prototype.updateUser=function(e,t){return i(this,void 0,void 0,(function(){var r,i,s,a,d;return o(this,(function(o){switch(o.label){case 0:if(l.isEmptyObject(t))throw new u.HttpException(400,"Model is not empty");return[4,this.userSchema.findById(e).exec()];case 1:if(!(r=o.sent()))throw new u.HttpException(404,"User not is exist.");if(i=r.avatar,r.email===t.email)throw new u.HttpException(400,"You must using the difference email");return i=c.default.url(t.email,{size:"200",rating:"g",default:"mm"}),r.password?[4,f.default.genSalt(10)]:[3,5];case 2:return a=o.sent(),[4,f.default.hash(t.password,a)];case 3:return d=o.sent(),[4,this.userSchema.findByIdAndUpdate(e,n(n({},t),{avatar:i,password:d})).exec()];case 4:return s=o.sent(),[3,7];case 5:return[4,this.userSchema.findByIdAndUpdate(e,n(n({},t),{avatar:i})).exec()];case 6:s=o.sent(),o.label=7;case 7:if(!s)throw new u.HttpException(409,"You are not an user");return[2,s]}}))}))},e.prototype.getUserById=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return[4,this.userSchema.findById(e).exec()];case 1:if(!(t=r.sent()))throw new u.HttpException(404,"User is not exists");return[2,t]}}))}))},e.prototype.getAll=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.userSchema.find().exec()];case 1:return[2,e.sent()]}}))}))},e.prototype.getAllPaging=function(e,t){return i(this,void 0,void 0,(function(){var r,n,i;return o(this,(function(o){switch(o.label){case 0:return r=Number(process.env.PAGE_SIZE||10),n={},e&&(n={$or:[{email:e},{first_name:e},{last_name:e}]}),[4,this.userSchema.find(n).skip((t-1)*r).limit(r).exec()];case 1:return i=o.sent(),[4,this.userSchema.find(n).countDocuments().exec()];case 2:return[2,{total:o.sent(),page:t,pageSize:r,items:i}]}}))}))},e.prototype.deleteUser=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return[4,this.userSchema.findByIdAndDelete(e)];case 1:if(!(t=r.sent()))throw new u.HttpException(400,"User not is exist");return[2,t]}}))}))},e.prototype.createToken=function(e){var t={id:e._id},r=process.env.JWT_TOKEN_SECRET;return{token:d.default.sign(t,r,{expiresIn:3600})}},e}();t.default=h},7728:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(1201);var i=n(r(6752)),o=r(1570),s=r(2333),u=r(9905),a=r(6553),l=r(418),c=r(2484);u.validateEnv();var f=[new o.IndexRoute,new s.UserRoute,new a.AuthRoute,new l.ProfileRoute,new c.PostRoute];new i.default(f).listen()},2773:e=>{e.exports=require("bcryptjs")},1576:e=>{e.exports=require("class-transformer")},516:e=>{e.exports=require("class-validator")},479:e=>{e.exports=require("cors")},1201:e=>{e.exports=require("dotenv/config")},9509:e=>{e.exports=require("envalid")},2127:e=>{e.exports=require("express")},7967:e=>{e.exports=require("gravatar")},6725:e=>{e.exports=require("helmet")},9910:e=>{e.exports=require("hpp")},9722:e=>{e.exports=require("jsonwebtoken")},5619:e=>{e.exports=require("mongoose")},8150:e=>{e.exports=require("morgan")},9876:e=>{e.exports=require("normalize-url")},6677:e=>{e.exports=require("swagger-ui-express")},944:e=>{e.exports=require("winston")},2615:e=>{e.exports=require("yamljs")}},t={};!function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}(7728)})();